<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YUG Strumming Generator</title>
  <style>
    :root{
      --bg:#0b0b0e;
      --panel:#13131a;
      --text:#f4f4f7;
      --muted:#b7b7c2;
      --accent:#e11d48; /* rouge "GOT vibe" */
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% 0%, #141424, var(--bg));
      color:var(--text);
      display:flex;
      min-height:100vh;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .wrap{
      width:min(920px, 100%);
      background: rgba(19,19,26,0.85);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:18px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.45);
      padding:18px;
      backdrop-filter: blur(10px);
    }
    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:end;
      margin-bottom:14px;
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
    }
    input, select{
      background: #0e0e14;
      border:1px solid rgba(255,255,255,0.10);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      width: 260px;
      font-size:14px;
    }
    input:focus, select:focus{
      border-color: rgba(225,29,72,0.6);
      box-shadow: 0 0 0 4px rgba(225,29,72,0.15);
    }
    .btn{
      background: linear-gradient(180deg, rgba(225,29,72,0.95), rgba(225,29,72,0.75));
      border:1px solid rgba(255,255,255,0.12);
      color:#fff;
      border-radius:12px;
      padding:10px 14px;
      cursor:pointer;
      font-weight:650;
      transition: transform .05s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: transparent;
      border:1px solid rgba(255,255,255,0.12);
      color: var(--text);
    }
    .hint{
      font-size:12px;
      color: var(--muted);
      margin-top:6px;
      line-height:1.35;
    }
    .canvasWrap{
      background: #000;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      padding:14px;
      display:flex;
      justify-content:center;
      overflow:auto;
    }
    canvas{
      max-width:100%;
      height:auto;
      image-rendering: crisp-edges;
    }
    .footer{
      margin-top:10px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .mini{
      font-size:12px;
      color: var(--muted);
    }
    code{
      background: rgba(255,255,255,0.06);
      padding:2px 6px;
      border-radius:8px;
      color:#fff;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <div>
        <label>Pattern (ex: D---d--u | ou 2211-x-- )</label>
        <input id="pattern" value="D---d--u" maxlength="64" />
        <div class="hint">
          Mapping (nouveau) :
          <code>D</code>=↓ fort, <code>d</code>=↓ léger,
          <code>U</code>=↑ fort, <code>u</code>=↑ léger,
          <code>x</code>=✕, <code>-</code>=silence •
          Compat : <code>1=↑</code> <code>2=↓</code>.
          Sépare des mesures avec <code>|</code>.
        </div>
      </div>

      <div>
        <label>Subdivision</label>
        <select id="subdiv">
          <option value="8">8e (1 & 2 & 3 & 4 &)</option>
          <option value="16">16e (1 e & a ...)</option>
        </select>
        <div class="hint">Par défaut: 8e = 8 caractères pour 1 mesure.</div>
      </div>

      <div>
        <label>Texte</label>
        <input id="title" value="-_YUG_- STRUM" maxlength="40" />
        <div class="hint">Optionnel (tu peux laisser vide).</div>
      </div>

      <button class="btn" id="download">Télécharger PNG</button>
      <button class="btn secondary" id="copy">Copier pattern “propre”</button>
    </div>

    <div class="canvasWrap">
      <canvas id="c" width="1400" height="360"></canvas>
    </div>

    <div class="footer">
      <div class="mini">Astuce vitesse : fais une “banque” de 20 patterns une fois → réutilise à vie.</div>
      <div class="mini">Fond noir + accent rouge (GOT vibe). Taille PNG prête pour overlay vidéo.</div>
    </div>
  </div>

<script>
(() => {
  // =========================================================
  // SECTION 1 — DOM (ce que le script "attrape" dans la page)
  // =========================================================
  const canvas    = document.getElementById('c');
  const ctx       = canvas.getContext('2d');
  const patternEl = document.getElementById('pattern');
  const subdivEl  = document.getElementById('subdiv');
  const titleEl   = document.getElementById('title');
  const dlBtn     = document.getElementById('download');
  const copyBtn   = document.getElementById('copy');

  // =========================================================
  // SECTION 2 — RÈGLES (c’est ici que tu changes le “langage”)
  // =========================================================
  // 2.1 Symboles affichés
  const SYMBOL = {
    // Nouveau système (maj = accent fort, min = léger)
    'D': '↓', 'd': '↓',
    'U': '↑', 'u': '↑',

    // Compat ancien système
    '1': '↑',
    '2': '↓',

    // Mute
    'x': '✕', 'X': '✕',

    // Silence
    '-': ' '
  };

  // 2.2 Couleurs
  const COLOR = {
    strong: 'rgba(225,29,72,0.95)',   // rouge accent
    normal: 'rgba(255,255,255,0.92)', // blanc
    mute:   'rgba(225,29,72,0.95)'    // mute en rouge
  };

  // =========================================================
  // SECTION 3 — PARSING (nettoyer le texte du pattern)
  // =========================================================
  function tokenize(raw) {
    // Autorise : D d U u 1 2 x X - | (séparateur mesures)
    return raw
      .replace(/[^DdUu12xX\-\_|]/g, '') // filtre
      .replace(/\s+/g, '');             // supprime espaces (on gère |)
  }

  function splitMeasures(tokens) {
    if (tokens.includes('|')) return tokens.split('|').filter(Boolean);
    return [tokens];
  }

  function padToSubdiv(s, subdiv) {
    // complète/trim pour coller à la subdivision (8 ou 16) par mesure
    if (s.length === subdiv) return s;
    if (s.length > subdiv) return s.slice(0, subdiv);
    return s.padEnd(subdiv, '-'); // IMPORTANT : on pad avec '-' (silence)
  }

  // =========================================================
  // SECTION 4 — LABELS TEMPO (1 & 2 & / 1 e & a ...)
  // =========================================================
  function buildBeatLabels(subdiv) {
    if (subdiv === 8) return ['1','&','2','&','3','&','4','&'];
    return ['1','e','&','a','2','e','&','a','3','e','&','a','4','e','&','a'];
  }

  // =========================================================
  // SECTION 5 — RENDER (dessiner sur le canvas)
  // =========================================================
  function getStrokeColor(ch, sym) {
    if (sym === '✕') return COLOR.mute;
    if (ch === 'D' || ch === 'U') return COLOR.strong; // accent fort (majuscules)
    return COLOR.normal; // d/u + 1/2 = normal
  }

  function draw() {
    const subdiv = Number(subdivEl.value);
    const raw = patternEl.value;
    const tokens = tokenize(raw);
    const measures = splitMeasures(tokens).map(m => padToSubdiv(m, subdiv));

    // config taille dynamique selon nb mesures
    const margin = 60;
    const cellW = 90;
    const measGap = 60;

    const gridW = measures.length * (subdiv * cellW) + (measures.length - 1) * measGap;
    const W = Math.max(1200, gridW + margin * 2);
    const H = 360;
    canvas.width = W;
    canvas.height = H;

    // fond
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,W,H);

    // titre
    const title = (titleEl.value || '').trim();
    if (title) {
      ctx.font = '700 34px system-ui, -apple-system, Segoe UI, Roboto, Arial';
      ctx.fillStyle = 'rgba(225,29,72,0.95)';
      ctx.fillText(title, margin, 54);
    }

    // labels
    const labels = buildBeatLabels(subdiv);

    // style
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    const topY = 110;
    const arrowY = 220;
    const baseLineY = 270;

    // baseline style
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.lineWidth = 2;

    // fonts
    const labelFont = '600 22px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    const arrowFont  = '700 56px system-ui, -apple-system, Segoe UI, Roboto, Arial';

    let x = margin;

    measures.forEach((m, mi) => {
      // beat labels + cells
      for (let i=0; i<subdiv; i++) {
        const cx = x + (i * cellW) + cellW/2;

        // label
        ctx.font = labelFont;
        ctx.fillStyle = 'rgba(255,255,255,0.70)';
        ctx.fillText(labels[i] || '', cx, topY);

        // arrow / mute / silence
        const ch = m[i] || '-';
        const sym = SYMBOL[ch] ?? ' ';
        ctx.font = arrowFont;

        // Couleur (accent / normal / mute)
        ctx.fillStyle = getStrokeColor(ch, sym);

        // Dessin
        ctx.fillText(sym, cx, arrowY);

        // baseline tick
        ctx.beginPath();
        ctx.moveTo(cx, baseLineY - 18);
        ctx.lineTo(cx, baseLineY + 18);
        ctx.stroke();
      }

      // baseline
      ctx.beginPath();
      ctx.moveTo(x, baseLineY);
      ctx.lineTo(x + subdiv*cellW, baseLineY);
      ctx.stroke();

      // séparation de mesure
      if (mi < measures.length - 1) {
        const sepX = x + subdiv*cellW + measGap/2;
        ctx.strokeStyle = 'rgba(225,29,72,0.35)';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(sepX, 90);
        ctx.lineTo(sepX, 310);
        ctx.stroke();
        ctx.strokeStyle = 'rgba(255,255,255,0.18)';
        ctx.lineWidth = 2;
      }

      x += subdiv*cellW + measGap;
    });

    // petit watermark discret
    ctx.textAlign = 'right';
    ctx.font = '600 14px system-ui, -apple-system, Segoe UI, Roboto, Arial';
    ctx.fillStyle = 'rgba(255,255,255,0.35)';
    ctx.fillText('YUG • strum', W - 18, H - 18);
  }

  // =========================================================
  // SECTION 6 — ACTIONS (boutons : télécharger / copier)
  // =========================================================
  function downloadPNG() {
    const a = document.createElement('a');
    a.download = 'yug-strum.png';
    a.href = canvas.toDataURL('image/png');
    a.click();
  }

  function copyPretty() {
    // renvoie une version lisible: "↓ ↓ ↑ ✕   ↓"
    const raw = patternEl.value;
    const tokens = tokenize(raw).replaceAll('|','');
    const pretty = tokens
      .split('')
      .map(ch => SYMBOL[ch] ?? '')
      .join(' ')
      .replace(/\s+/g,' ')
      .trim();
    navigator.clipboard.writeText(pretty).catch(() => {});
  }

  // =========================================================
  // SECTION 7 — EVENTS (quand tu tapes / cliques)
  // =========================================================
  patternEl.addEventListener('input', draw);
  subdivEl.addEventListener('change', draw);
  titleEl.addEventListener('input', draw);
  dlBtn.addEventListener('click', downloadPNG);
  copyBtn.addEventListener('click', copyPretty);

  // Première génération
  draw();
})();
</script>
</body>
</html>
